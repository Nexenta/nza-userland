#include "variables"
#! /bin/bash -e
#
# <% elisp %> Emacs remove script for <:=${PACKAGE}:>
#
<:=@COPYRIGHT:>//

set -o posix

FLAVOR=${1}

undo_install () {
    echo >&2 -n "remove/<:=${PACKAGE}:>: Removing for ${FLAVOR}... "
    rm -f <:=if($_=${lisp})=~s|emacs|\${FLAVOR}|:>/../{auctex,tex-site}.el
    rm -f <:=if($_=${lisp})=~s|emacs|\${FLAVOR}|:>/../preview-latex.el
    rm -f <:=if($_=${lisp})=~s|emacs|\${FLAVOR}|:>/<:=${ELCLOG}:>{,.gz}
    rm -f <:=if($_=${lisp})=~s|emacs|\${FLAVOR}|:>/images
    rm -f <:=if($_=${lisp})=~s|emacs|\${FLAVOR}|:>/*.el
    rm -f <:=if($_=${lisp})=~s|emacs|\${FLAVOR}|:>/*.elc
    rm -f <:=if($_=${lisp})=~s|emacs|\${FLAVOR}|:>/.nosearch
    rm -f <:=if($_=${style})=~s|emacs|\${FLAVOR}|:>/*.elc
    rm -f <:=if($_=${style})=~s|emacs|\${FLAVOR}|:>/.nosearch
    test -d <:=if($_=${style})=~s|emacs|\${FLAVOR}|:> && \
	rmdir --ignore-fail-on-non-empty \
	<:=if($_=${style})=~s|emacs|\${FLAVOR}|:>
    test -d <:=if($_=${lisp})=~s|emacs|\${FLAVOR}|:> && \
	rmdir --ignore-fail-on-non-empty \
	<:=if($_=${lisp})=~s|emacs|\${FLAVOR}|:>
    echo >&2 "done."
    return 0
}

undo_auto () {
    rm -rf <:="${var}/\${FLAVOR}/":>

    <:# old cruft introduced in 11.83-7.3, catered for in 11.83-8 :>//
    rm -f /var/log/auctex.log

    LOGFILE=<:=if($_=${LOGFILE})=~s|emacs|\${FLAVOR}|:>
    rm -f ${LOGFILE}
    return 0
}

case "${FLAVOR}" in
    emacs) :;;
    emacs2[123]|emacs-snapshot)
	<:# remove all parsed information files :>//
	undo_auto
	undo_install;;
    *) echo >&2 "remove/<:=${PACKAGE}:>:" \
	"Ignoring emacsen flavor: \"${FLAVOR}\"."
esac

exit 0
<:
# local variables:
# mode: shell-script
# ispell-local-dictionary: "american"
# ispell-check-comments: exclusive
# end:
:>//
