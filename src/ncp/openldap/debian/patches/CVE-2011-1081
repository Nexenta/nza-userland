Origin: cvs PatchSet 24550 from OPENLDAP_REL_ENG_2_4
Description: fix DoS when processing unauthenticated modrdn requests and
 requestDN is empty
Bug: http://www.openldap.org/its/index.cgi/Software%20Bugs?id=6768
Bug-Novell: https://bugzilla.novell.com/show_bug.cgi?id=674985#c1

Index: openldap-2.4.23/servers/slapd/modrdn.c
===================================================================
--- openldap-2.4.23.orig/servers/slapd/modrdn.c	2011-03-16 09:44:03.000000000 -0500
+++ openldap-2.4.23/servers/slapd/modrdn.c	2011-03-16 09:44:07.000000000 -0500
@@ -392,7 +392,9 @@
 	LDAPRDN		new_rdn = NULL;
 
 	assert( !BER_BVISEMPTY( &op->oq_modrdn.rs_newrdn ) );
-	assert( !op->orr_deleteoldrdn || !BER_BVISEMPTY( &op->o_req_dn ) );
+
+	/* if requestDN is empty, silently reset deleteOldRDN */
+	if ( BER_BVISEMPTY( &op->o_req_dn ) ) op->orr_deleteoldrdn = 0;
 
 	if ( ldap_bv2rdn_x( &op->oq_modrdn.rs_newrdn, &new_rdn,
 		(char **)&rs->sr_text, LDAP_DN_FORMAT_LDAP, op->o_tmpmemctx ) ) {
