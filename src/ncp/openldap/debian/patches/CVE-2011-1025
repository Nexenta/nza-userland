Origin: cvs PatchSets 24176 and 24177 from HEAD
Description: verify password when authenticating to rootdn and using ndb
 backend
Bug: http://www.openldap.org/its/index.cgi/Software%20Bugs?id=6661

Index: openldap-2.4.23/servers/slapd/back-ndb/bind.cpp
===================================================================
--- openldap-2.4.23.orig/servers/slapd/back-ndb/bind.cpp	2011-03-16 09:35:42.000000000 -0500
+++ openldap-2.4.23/servers/slapd/back-ndb/bind.cpp	2011-03-16 09:37:17.000000000 -0500
@@ -42,11 +42,17 @@
 		op->o_req_dn.bv_val, 0, 0);
 
 	/* allow noauth binds */
-	switch ( be_rootdn_bind( op, NULL ) ) {
+	rs->sr_err = be_rootdn_bind( op, NULL );
+	switch ( rs->sr_err ) {
 	case SLAP_CB_CONTINUE:
 		break;
 
-	default:
+	case LDAP_INVALID_CREDENTIALS:
+		send_ldap_result( op, rs );
+		/* fallthru */
+
+	case LDAP_SUCCESS:
+		/* frontend will send result */
 		return rs->sr_err;
 	}
 
