From: Davide G. M. Salvetti <salve@debian.org>
Date: Fri, 27 Aug 2010 13:02:00 +0200
Subject: [PATCH] Rationalize HTML documentation targets in doc/Makefile.in.

- Use auctex.htmls instead of html as the name of the directory where
  AUCTeX HTMLs go.
- Use auctex.html instead of auctex_toc.html as the AUCTeX HTML
  documentation entry point; add index.html as a symlink to it.
- Let the auctex.htmls/auctex.html target (ex html/auctex_toc.html) depend
  on all $(AUCTEXTEXIFILES) instead of just auctex.texi.
- Refactor AUCTeX HTML documentation build command.

- Use preview-latex.htmls instead of preview-latex as the name of the
  directory where preview-latex HTMLs go.
- Use preview-latex.html instead of index.html as the preview-latex HTML
  documentation entry point; add index.html as a symlink to it.
- Refactor preview-latex HTML documentation build command.

- Update references in extradist, html-docs, and clean targets.
---
 doc/Makefile.in |   23 ++++++++++++-----------
 1 files changed, 12 insertions(+), 11 deletions(-)

diff --git a/doc/Makefile.in b/doc/Makefile.in
index d2be29e..7c383a8 100644
--- a/doc/Makefile.in
+++ b/doc/Makefile.in
@@ -72,18 +72,17 @@ install-man:
 
 dist: $(DISTTEXTS) preview-latex.info auctex.info tex-ref.pdf
 
-extradist: html/auctex_toc.html auctex.ps auctex.pdf tex-ref.ps tex-ref.pdf
+extradist: auctex.htmls/auctex.html auctex.ps auctex.pdf tex-ref.ps tex-ref.pdf
 
 .PHONY: all info dvi dist install-auctex disttexts clean distclean \
 	maintainer-clean install-preview install-man html-docs extradist
 
 # AUCTeX
 
-html/auctex_toc.html: auctex.texi
-	rm -rf html
-	mkdir html
-	cd html && $(TEXI2HTML) -split_node -I .. ../auctex.texi && \
-	test ! -d auctex || { mv auctex/* . && rm -rf auctex ; }
+auctex.htmls/auctex.html: $(AUCTEXTEXIFILES)
+	rm -rf auctex.htmls/
+	$(TEXI2HTML) --output=auctex.htmls -split=chapter auctex.texi
+	ln -s auctex.html auctex.htmls/index.html
 
 tex-ref.dvi: tex-ref.tex
 	$(TEX) tex-ref
@@ -128,11 +127,13 @@ install-auctex: auctex.info tex-ref.pdf
 
 # preview
 
-preview-latex/index.html: $(PREVIEWTEXIFILES)
-	rm -f preview-latex/*
-	$(TEXI2HTML) preview-latex.texi
+preview-latex.htmls/preview-latex.html: $(PREVIEWTEXIFILES)
+	rm -rf preview-latex.htmls/
+	$(TEXI2HTML) --output=preview-latex.htmls \
+		-split=chapter preview-latex.texi
+	ln -s preview-latex.html preview-latex.htmls/index.html
 
-html-docs: preview-latex/index.html
+html-docs: preview-latex.htmls/preview-latex.html
 
 preview-dtxdoc.texi: ../preview/latex/preview.dtx preview-dtxdoc.pl
 	-$(PERL) preview-dtxdoc.pl ../preview/latex/preview.dtx \
@@ -189,7 +190,7 @@ clean:
 	rm -f *.dvi *.ps *.pdf *.aux *.cp *.fn *.ky *.log *~ \#*\# \
 		*.tp *.vr *.pg *.toc *.tp *.bak *.cps *.kys *.tps \
 		*.fns *.vrs *.pgs *.tmp *.html
-	rm -rf html preview-latex
+	rm -rf auctex.htmls/ preview-latex.htmls/
 
 distclean: clean
 	rm -f Makefile
-- 
